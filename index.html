<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sua Lista de Compras</title>
  <style>
    body { font-family: Arial, sans-serif; margin-bottom:60px; }
    nav { text-align: center; margin-bottom: 20px; }
    nav button { margin: 5px; font-size: 18px; padding: 5px 10px; border-radius: 25px; }
    h1 { text-align: center; }
    input, button, select { padding: 5px; font-size: 14px; border-radius: 12px; }
    input[type="text"], input[type="number"] { 
      width: 50%; 
      margin: 8px auto; 
      display: block;
      text-align: center; 
      border-radius: 12px;
      box-sizing: border-box;
    }
    .containerForm {
      max-width: 500px;
      margin: 0 auto;
      padding: 10px;
    }
    #listaCompras, #itensSugeridos { list-style-type: none; padding: 0; }
    li { margin: 15px 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .comprado { text-decoration: line-through; color: green; }
    .erro { color: red; font-size: 14px; margin-top: 5px; }
    .fotoProduto { width: 50px; height: 50px; object-fit: cover; margin-right:5px; border-radius:4px; }
    .qtdControles button { margin: 0 2px; font-size: 14px; border-radius: 10px; }
    .iconBtn { background:none; border:none; cursor:pointer; font-size:16px; margin: 0 4px; }
    #catalogoGrid { 
      display:grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap:15px; 
      margin-top:10px;
    }
    .produtoCatalogo { 
      background:#f0f0f0; 
      padding:8px; 
      text-align:center; 
      cursor:pointer; 
      border-radius:8px; 
      width:2cm; 
      height:2cm; 
      display:flex; 
      flex-direction:column; 
      justify-content:center; 
      align-items:center;
    }
    .produtoCatalogo:hover { background:#ddd; }
    #modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:none; justify-content:center; align-items:center; z-index:1000; }
    #modalContent { background:#fff; padding:20px; border-radius:8px; }
    .total {
      font-weight: bold;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #f0f0f0;
      padding: 2px;
      font-size: 15px;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
      text-align: center;
      z-index: 999;
    }
    .produtoCatalogo img { width: 100%; height: 100%; object-fit: cover; border-radius:5px; }
    .listasBox { text-align:center; margin-bottom:10px; }
  </style>
</head>
<body>
  <h1>Sua Lista de Compras</h1>
  <nav>
    <button onclick="abrirAba('inicio')">üè† In√≠cio</button>
    <button onclick="abrirAba('catalogo')">üõí Cat√°logo</button>
  </nav>

  <div id="abaInicio">
    <div class="listasBox">
      <label>Lista atual:</label>
      <select id="listaSelect" onchange="trocarLista()"></select>
      <button onclick="novaLista()">‚ûï Nova lista</button>
    </div>
    <div class="containerForm">
      <h2>Adicione um item</h2>
      <input type="text" id="itemInput" placeholder="Digite o nome do item">
      <input type="text" id="precoInput" placeholder="Valor(R$)" oninput="mascaraMoeda(this)">
      <input type="number" id="quantidadeInput" placeholder="Quantidade" step="1" min="1">
      <p id="mensagemErro" class="erro"></p>
    </div>
    <h2>Lista de Compras</h2>
    <ul id="listaCompras"></ul>
  </div>

  <div id="abaCatalogo" style="display:none;">
    <h2>Cat√°logo de Produtos</h2>
    <input type="text" id="campoPesquisa" placeholder="Pesquisar produto..." onkeyup="filtrarCatalogo()">
    <div id="catalogoGrid"></div>
  </div>

  <div id="modal">
    <div id="modalContent">
      <h3 id="modalTitulo"></h3>
      <p>Pre√ßo (R$): <input type="text" id="modalPreco" oninput="mascaraMoeda(this)"></p>
      <p>Quantidade: <input type="number" id="modalQtd" min="1"></p>
      <button onclick="confirmarModal()">‚úÖ Confirmar</button>
      <button onclick="fecharModal()">‚ùå Cancelar</button>
    </div>
  </div>

  <div class="total">
    <p>Total Estimado: R$ <span id="total">0,00</span></p>
  </div>

<script>
let produtoSelecionadoModal = "";
let listas = JSON.parse(localStorage.getItem("todasListas")) || { "Principal":[] };
let listaAtual = localStorage.getItem("listaAtual") || "Principal";

// ---------------- Fun√ß√µes para m√∫ltiplas listas ----------------
function atualizarSelectListas(){
  const sel = document.getElementById("listaSelect");
  sel.innerHTML = "";
  Object.keys(listas).forEach(nome=>{
    const opt = document.createElement("option");
    opt.value = nome;
    opt.textContent = nome;
    if(nome===listaAtual) opt.selected=true;
    sel.appendChild(opt);
  });
}

function novaLista(){
  const nome = prompt("Nome da nova lista:");
  if(!nome) return;
  if(listas[nome]){
    alert("J√° existe uma lista com esse nome.");
    return;
  }
  listas[nome] = [];
  listaAtual = nome;
  salvarListas();
  atualizarSelectListas();
  carregarLista();
}

function trocarLista(){
  const sel = document.getElementById("listaSelect");
  listaAtual = sel.value;
  localStorage.setItem("listaAtual", listaAtual);
  carregarLista();
}

function salvarListas(){
  localStorage.setItem("todasListas", JSON.stringify(listas));
  localStorage.setItem("listaAtual", listaAtual);
}

// ---------------- L√≥gica de abas ----------------
function abrirAba(qual) {
  document.getElementById("abaInicio").style.display = qual==='inicio' ? 'block':'none';
  document.getElementById("abaCatalogo").style.display = qual==='catalogo' ? 'block':'none';
}

// ---------------- Modal ----------------
function abrirModal(produto){
  produtoSelecionadoModal = produto;
  document.getElementById("modalTitulo").textContent = produto;
  document.getElementById("modalPreco").value = "";
  document.getElementById("modalQtd").value = "";
  document.getElementById("modal").style.display = "flex";
}
function fecharModal(){ document.getElementById("modal").style.display = "none"; }
function confirmarModal(){
  let precoStr = document.getElementById("modalPreco").value.trim().replace("R$", "").replace(",",".");
  const preco = parseFloat(precoStr) || 0;
  const qtd = parseInt(document.getElementById("modalQtd").value,10) || 1;
  criarItem(produtoSelecionadoModal, preco, qtd);
  fecharModal();
}

// ---------------- Fun√ß√µes principais ----------------
function mascaraMoeda(elemento) {
  let valor = elemento.value.replace(/\D/g, '');
  if (valor === '') { elemento.value = ""; return; }
  while (valor.length < 3) valor = '0' + valor;
  const reais = valor.slice(0, valor.length - 2);
  const centavos = valor.slice(-2);
  elemento.value = "R$ " + parseInt(reais).toString() + ',' + centavos;
}

function adicionarItem(){
  const nome = document.getElementById("itemInput").value.trim();
  const precoStr = document.getElementById("precoInput").value.trim().replace("R$", "").replace(",",".");
  const preco = parseFloat(precoStr) || 0;
  const qtd = parseInt(document.getElementById("quantidadeInput").value.trim());
  const erro = document.getElementById("mensagemErro");
  erro.textContent = "";
  if(nome === "" || isNaN(qtd) || qtd<1){
    erro.textContent = "Preencha todos os campos corretamente.";
    return;
  }
  criarItem(nome, preco, qtd);
  document.getElementById("itemInput").value = "";
  document.getElementById("precoInput").value = "";
  document.getElementById("quantidadeInput").value = "";
  setTimeout(() => { document.getElementById("itemInput").focus(); }, 100);
}

function criarItem(nome, preco, qtd){
  // adiciona ao array da lista atual
  listas[listaAtual].push({nome,preco,qtd,comprado:false});
  ordenarListaAtual();
  renderizarLista();
  salvarListas();
}

function ordenarListaAtual(){
  listas[listaAtual].sort((a,b)=> a.nome.localeCompare(b.nome,'pt-BR'));
}

function renderizarLista(){
  const ul = document.getElementById("listaCompras");
  ul.innerHTML = "";
  listas[listaAtual].forEach((item,i)=>{
    const li = document.createElement("li");
    li.innerHTML = `
      <input type="checkbox" ${item.comprado?"checked":""} onclick="marcarComprado(${i},this)">
      <span>${item.nome} - 
        <input type="text" value="R$ ${item.preco.toFixed(2).replace(".",",")}"
               oninput="mascaraMoeda(this);editarPrecoDireto(${i},this)"
               readonly
               onfocus="this.removeAttribute('readonly');">
      </span>
      <div class="qtdControles">
        <button class="iconBtn" onclick="alterarQtd(${i},-1)">‚ûñ</button>
        <span class="qtd">${item.qtd}</span>
        <button class="iconBtn" onclick="alterarQtd(${i},1)">‚ûï</button>
      </div>
      <button class="iconBtn" onclick="removerItem(${i})">üóëÔ∏è</button>
    `;
    if(item.comprado) li.classList.add("comprado");
    ul.appendChild(li);
  });
  atualizarTotal();
}

function editarPrecoDireto(i,input){
  let precoStr = input.value.trim().replace("R$","").replace(",",".");
  let preco = parseFloat(precoStr);
  if (isNaN(preco) || preco < 0) preco = 0;
  listas[listaAtual][i].preco = preco;
  input.value = "R$ " + preco.toFixed(2).replace(".",",");
  atualizarTotal();
  salvarListas();
}

function alterarQtd(i,delta){
  let item = listas[listaAtual][i];
  item.qtd = Math.max(1, item.qtd + delta);
  renderizarLista();
  salvarListas();
}

function marcarComprado(i,cb){
  listas[listaAtual][i].comprado = cb.checked;
  renderizarLista();
  salvarListas();
}

function removerItem(i){
  listas[listaAtual].splice(i,1);
  renderizarLista();
  salvarListas();
}

function atualizarTotal(){
  let total = listas[listaAtual].reduce((acc,it)=>acc+(it.preco*it.qtd),0);
  document.getElementById("total").textContent = total.toFixed(2).replace(".",",");
}

function carregarLista(){
  ordenarListaAtual();
  renderizarLista();
  atualizarSelectListas();
}
carregarLista();

// Enter navega√ß√£o
document.querySelectorAll("#itemInput, #precoInput, #quantidadeInput").forEach((input, index, inputs) => {
  ["keydown","keyup"].forEach(evName=>{
    input.addEventListener(evName, function(e) {
      if (e.key === "Enter") {
        e.preventDefault();
        if (index < inputs.length - 1) {
          inputs[index + 1].focus();
        } else {
          adicionarItem();
        }
      }
    });
  });
});

function filtrarCatalogo(){
  const filtro = document.getElementById("campoPesquisa").value.toLowerCase();
  document.querySelectorAll(".produtoCatalogo").forEach(el=>{
    el.style.display = el.textContent.toLowerCase().includes(filtro) ? 'flex':'none';
  });
}

// ---------------- cat√°logo ----------------
const nomes = [
  "Ma√ß√£","Banana","Laranja","Batata","Cenoura","Tomate","Alface","Couve","Espinafre",
  "Carne Bovina","Frango","Peixe","Ovos","Arroz","Feij√£o","Macarr√£o","Farinha de trigo","A√ß√∫car","Sal","√ìleo","Caf√©","Enlatados",
  "Shampoo","Condicionador","Sabonete","Pasta de dente","Absorventes","Desodorante",
  "Detergente","Sab√£o em p√≥","√Ågua sanit√°ria","Amaciante","Desinfetante","Esponjas","√Ågua","Sucos","Refrigerantes","Cervejas","Sucos em p√≥","Congelados","Latic√≠nios","P√£es e frios","Biscoitos",
  "Doces","Itens de papelaria","Descart√°veis","Para animais","Para casa"
];
const emojiMap = {
  "Ma√ß√£":"üçé","Banana":"üçå","Laranja":"üçä","Batata":"ü•î","Cenoura":"ü•ï","Tomate":"üçÖ",
  "Alface":"ü•¨","Couve":"ü•¶","Espinafre":"üåø","Carne Bovina":"ü•©","Frango":"üçó","Peixe":"üêü",
  "Ovos":"ü•ö","Arroz":"üçö","Feij√£o":"ü´ò","Macarr√£o":"üçù","Farinha de trigo":"üåæ",
  "A√ß√∫car":"üßÇ","Sal":"üßÇ","√ìleo":"üõ¢Ô∏è","Caf√©":"‚òï","Enlatados":"ü•´",
  "Shampoo":"üß¥","Condicionador":"üß¥","Sabonete":"üßº","Pasta de dente":"ü™•","Absorventes":"ü©∏","Desodorante":"üß¥","Detergente":"üßΩ",
  "Sab√£o em p√≥":"üßº","√Ågua sanit√°ria":"üß™","Amaciante":"üß¥","Desinfetante":"üß¥",
  "Esponjas":"üßΩ","√Ågua":"üíß","Sucos":"üßÉ","Refrigerantes":"ü•§",
  "Cervejas":"üç∫","Sucos em p√≥":"üçπ","Congelados":"üßä","Latic√≠nios":"üßÄ",
  "P√£es e frios":"ü•ñ","Biscoitos":"üç™","Doces":"üç¨","Itens de papelaria":"‚úèÔ∏è",
  "Descart√°veis":"ü•°","Para animais":"üê∂","Para casa":"üè†"
};
const grid = document.getElementById("catalogoGrid");
nomes.forEach(nome => {
  const emoji = emojiMap[nome] || "üì¶";
  grid.innerHTML += `
    <div class="produtoCatalogo" onclick="abrirModal('${nome}')">
      <div style="font-size:24px;">${emoji}</div>
      <span>${nome}</span>
    </div>`;
});
</script>
</body>
</html>
